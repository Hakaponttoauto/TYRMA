<!DOCTYPE html>
<html>
<head>
<title>Page Title</title>
</head>
<body>

<p style="font-family: 'Courier New', monospace;" id="screen">hei</p>

</body>
<script>
	let map=[];
	let width=34;
	let height=138;

	color_wall = "rgb(120,110,100)"
	color_ground = "rgb(60,55,50)"

	let objects_list=[
		{char: "M",color: "green", bgcolor: color_ground},
		{char: "/",color: "white", bgcolor: color_ground},
		{char: "]",color: "white", bgcolor: color_ground},
		{char: "=",color: "yellow", bgcolor: color_ground},
		{char: "!",color: "purple", bgcolor: color_ground},
		{char: "S",color: "lightgreen", bgcolor: color_ground},
		{char: "K",color: "green", bgcolor: color_ground},
		{char: "%",color: "red", bgcolor: color_ground}
	];

	function initmap() {
		for (x = 0; x < width; x++) {
	    	map[x]=[]
	        for (y = 0; y < height; y++) {
	    		map[x][y]={char: "+",color: "black", bgcolor: "black"}
	   		}
	    }
	}

	function random(from,to) {
		return Math.floor(Math.random()*(to-from)+from);
	}

	function intercepts(self,list) {
		for (other of list) {
	    	 if (self.x1 <= other.x2 && self.x2 >= other.x1 && self.y1 <= other.y2 && self.y2 >= other.y1) {
	         	return true
	         }
	    }
	    return false;
	}

	function generatemap() {
		initmap();

		rooms=[];

		hasplayer=false;

		for (r=1; r<15; r++) {
			w=random(5,18);
			h=random(5,18);

			if (rooms.length>0) {
				last=rooms[rooms.length-1];
				rx=random(Math.max(last.x1-(last.w*2)-(w*2),2),Math.min(last.x2+(last.w*2)+(w*2),width-w-2));
				ry=random(Math.max(last.y1-(last.h*2)-(h*2),2),Math.min(last.y2+(last.h*2)+(h*2),height-h-2));
			}	else {
				rx=random(2,width-w);
				ry=random(2,height-h);
			}

			croom={x1: rx, y1: ry, x2: rx+w, y2: ry+h, w: w, h: h};
			croom.xc=Math.floor((croom.x1+croom.x2)/2);
			croom.yc=Math.floor((croom.y1+croom.y2)/2);

			while (intercepts(croom,rooms)) {
				w=random(3,8);
				h=random(3,8);
				rx=0;
				ry=0;

				if (rooms.length>0) {
					last=rooms[rooms.length-1];
					rx=random(Math.max(last.x1-(last.w*2)-(w*2),2),Math.min(last.x2+(last.w*2)+(w*2),width-w-2));
					ry=random(Math.max(last.y1-(last.h*2)-(h*2),2),Math.min(last.y2+(last.h*2)+(h*2),height-h-2));
				}	else {
					rx=random(2,width-w);
					ry=random(2,height-h);
				}

				croom={x1: rx, y1: ry, x2: rx+w, y2: ry+h};
				croom.xc=Math.floor((croom.x1+croom.x2)/2);
				croom.yc=Math.floor((croom.y1+croom.y2)/2);
			}

			if (rooms.length>0) {
				last=rooms[rooms.length-1];
				if (Math.random()>=0.5) {
					h_tunnel(last.xc, croom.xc, last.yc);
					v_tunnel(last.yc, croom.yc, croom.xc);
				} else {
					v_tunnel(last.yc, croom.yc, last.xc);
					h_tunnel(last.xc, croom.xc, croom.yc);
				}
			}

			success=room(rx,ry,w,h);
			if (success) {
				rooms.push(croom);
			}
		}
		for (room_index in rooms) {
			room=rooms[room_index]
			objects(room)
			if (room_index==0) {
				map[room.xc][room.yc] = {char: "@",color: "white", bgcolor: color_ground};
			}
		}
	}

	function h_tunnel(x1, x2, y) {
	    for (x = Math.min(x1, x2); x <= Math.max(x1, x2); x++) {
	    	map[x][y]={char: ".",color: "dimGray", bgcolor: color_ground}
	    }
	}

	function v_tunnel(y1, y2, x) {
	    for (y = Math.min(y1, y2); y <= Math.max(y1, y2); y++) {
	    	map[x][y]={char: ".",color: "dimGray", bgcolor: color_ground}
	    }
	}

	function objects(room) {
		for (o=0; o<random(2,5); o++) {
			try {
				ox=random(room.x1+1,room.x2-1);
				oy=random(room.y1+1,room.y2-1);
				object=objects_list[random(0,objects_list.length)];
				map[ox][oy]=object;
			} catch {
				//GUESS WHAT I AM GONNA DO TO THIS ERROR? NOTHING, SUCKERS!
			}
		}
	}

	function room(x,y,w,h) {
		try {
			for (x2 = 0; x2 <= w; x2++) {
				for (y2 = 0; y2 <= h; y2++) {
					if ((x2==0 || x2==w || y2==0 || y2==h) && map[x+x2][y+y2].char=="+") {
						map[x+x2][y+y2]={char: "#",color: "gray", bgcolor: color_wall}
					} else {
						map[x+x2][y+y2]={char: ".",color: "dimGray", bgcolor: color_ground}
					}
				}
			}
			return true
		} catch {
			//I DID IT AGAIN!!!!

			return false
			//JUST KIDDING :)
		}
	}

	function render() {
		screen=document.getElementById("screen");
		let print="";
		for (row of map) {
			for (tile of row) {
				styled=`<span style="color: ${tile.color}; background-color: ${tile.bgcolor};">${tile.char}</span>`;
				print+=styled;
			}
			print+="<br>";
		}
		screen.innerHTML=print;
	}

	function update() {
		generatemap();
		render();
	}

	update();
	setInterval(update,10000);
</script>
</html>
